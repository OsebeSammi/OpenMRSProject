<htmlform>

<macros>
    paperFormId = (Fill this in)
    headerColor =#c0c0c0
    sectionHeader =#000000
    fontOnHeaderColor = white
</macros>
<style>
    .maincopy
    {
        font-family: verdana,arial, halvetica;
        font-size:11px;
        text-decoration: none;
        font-weight: normal;
        text-style: none;
        line-height: 15px;
        font-style: normal;
        font-weight:normal;
    }
    .textalign_right
    {
        text-align:right;
        font-weight:bold;
        color: #C60;
        padding-right:25px;
        font-size:11px;
    }

    .section {
        border: 1px solid $headerColor;
        padding: 2px;
        text-align: left;
        margin-bottom: 1em;
        border-bottom-left-radius: 12px;
        border-bottom-right-radius: 12px;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
    //color:#000000

        }
    .sectionHeader {
        background-color: $headerColor;
        color:  $sectionHeader;
        display:block;
        padding: 2px;
        position:relative;
        margin-left: 5px;
        margin-right: 5px;
        font-weight: bold;
        text-align: center;
        height: 30px;
    }

    table.baseline-aligne tr td.ki {
        vertical-align: baseline;
        position: relative;
        margin-left: 12px;

    }
    table.baseline-aligned td.label{
        color: brown;
    }

        /*TAB*/

    ul.tabs {
        margin: 0;
        padding: 0;
        float: left;
        list-style: none;
        height: 32px; /*--Set height of tabs--*/
        border-bottom: 1px solid #999;
        border-left: 1px solid #999;
        width: 100%;
    }
    ul.tabs li {
        float: left;
        margin: 0;
        padding: 0;
        height: 31px; /*--Subtract 1px from the height of the unordered list--*/
        line-height: 31px; /*--Vertically aligns the text within the tab--*/
        border: 1px solid #999;
        border-left: none;
        margin-bottom: -1px; /*--Pull the list item down 1px--*/
        overflow: hidden;
        position: relative;
        background: #e0e0e0;
    }
    ul.tabs li a {
        text-decoration: none;
        color: #000;
        display: block;
        font-size: 1.2em;
        padding: 0 20px;
        border: 1px solid #fff; /*--Gives the bevel look with a 1px white border inside the list item--*/
        outline: none;
    }
    ul.tabs li a:hover {
        background: #ccc;
    }
    html ul.tabs li.active, html ul.tabs li.active a:hover  { /*--Makes sure that the active tab does not listen to the hover properties--*/
        background: #fff;
        border-bottom: 1px solid #fff; /*--Makes the active tab look like it's connected with its content--*/
    }

    .tab_container {
        border: 1px solid #999;
        border-top: none;
        overflow: hidden;
        clear: both;
        background: #fff;
    }
    .tab_content {
        padding: 20px;
        font-size: 1.2em;
    }

    .divmain  {
        height: 80px;
        border: 1px solid grey;
        width: 280px;
        overflow: hidden;
    }

    .childmain{
        width: 100%;
        overflow: auto;
        height: 100%;
        padding-right: 17px;
    }

</style>
<script type="text/javascript" charset="utf-8">
    var hivDiscovered = (1980*365)+((1/12)*365)+1;  
    var dateOfBirth;
    $(document).ready(function() {
  
         $(function () {
   var hv = $('#w7').val();
   var pieces= hv.split('-');
    pieces.reverse();
var reversed = pieces.join('-');
  $('#dob').val(reversed);
   dateOfBirth = $('#dob').val();
 //alert(dateOfBirth);

     });
        //When page loads...
        $(".tab_content").hide(); //Hide all content
        $("ul.tabs li:first").addClass("active").show(); //Activate first tab
        $(".tab_content:first").show(); //Show first tab content

        //On Click Event
        $("ul.tabs li").click(function() {
            $("ul.tabs li").removeClass("active"); //Remove any "active" class
            $(this).addClass("active"); //Add "active" class to selected tab
            $(".tab_content").hide(); //Hide all tab content

            var activeTab = $(this).find("a").attr("href"); //Find the href attribute value to identify the active tab + content
            $(activeTab).fadeIn(); //Fade in the active ID content
            return false;
        });

        $("ul.tabs_visit_form2 li").click(function() {
            $("ul.tabs li:first").removeClass("active"); //Remove any "active" class
            $("ul.tabs li:eq(1)").addClass("active").show(); //Activate second tab
            $(".tab_content:eq(1)").show(); //Show second tab content
            $(this).addClass("active"); //Add "active" class to selected tab
            $(".tab_content").hide(); //Hide all tab content

            var activeTab = $(this).find("a").attr("href"); //Find the href attribute value to identify the active tab + content
            $(activeTab).fadeIn(); //Fade in the active ID content
            return false;
        });
        
beforeSubmit.push(function(){
    var submit = true;
 //alert(submit+"1st");
 //$("#try").append("dvsdfgsdf");
 
$j(function() {
 //setValue('weight.error',"*wrong input*");
 var value=getValue('height.value');
 if(value!="")
 {
     getField('height.error').html(height(value)).show();
     if(height(value)!=null)
     {
      submit = false;   
     }
            
 }
 });
 
 
 $j(function() {
 //setValue('weight.error',"*wrong input*");
 var value=getValue('weight.value');
 if(value!="")
 {
     getField('weight.error').html(weight(value)).show();
      if(weight(value)!=null)
     {
      submit = false;   
     }
 }
 
 });
 
$j(function() {
 //setValue('weight.error',"*wrong input*");
 var value=getValue('fpStatus.value');
 var age = getValue('age.value');
 if(age!=null)
 {  
     if(value!="")
     {
         getField('fpStatus.error').html(fp64(age,value)).show();
          if(fp64(age,value)!=null)
     {
      submit = false;   
     }
     }
     
 }
 
 //setValue('weight.value', "90");
 
 });
 
 

 $j(function() {
 //setValue('weight.error',"*wrong input*");
 var value = getValue('pg.value');
 var age = getValue('age.value');
 
 if(age!=null)
 {
     if(value!="")
     {   
         
         getField('pg.error').html(pg61(age,value)).show();
          if(pg61(age,value)!=null)
     {
      submit = false;   
     }
     }
 }
 });
 
 
 $j(function() {
   
 //setValue('weight.error',"*wrong input*");
 var value = getValue('cd4p.value');
 if(value!="")
 {
     getField('cd4p.error').html(CD4Percentage(value)).show();
      if(CD4Percentage(value)!=null)
     {
      submit = false;   
     }
 }
 
 });
 
 
 $j(function() {
 //setValue('weight.error',"*wrong input*");
 var value = getValue('cd4c.value');
 var age = getValue('age.value');
 
 if(value!="")
 {
     if(age!=null)
     {
         getField('cd4c.error').html(CD4(value,age)).show();
             if(CD4(value,age)!=null)
     {
      submit = false;   
     }
     }
     
 }
 
 });
 
 $j(function() {
 //setValue('weight.error',"*wrong input*");
 var currentVisit = getValue('currentVisit.value');
 var next = getValue('next.value');
 
 
 
 if(next!="")
 {
     if(currentVisit!="")
     { 
         
         getField('next.error').html(nxtvisit71(next,currentVisit)).show();
                  if(nxtvisit71(next,currentVisit)!=null)
     {
      submit = false;   
     }
     }
     
 }
 
 });
 
 $j(function() {
            //setValue('weight.error',"*wrong input*");
            var artDates = getValue('artStartDate.value');
            var dob = dateOfBirth;


                    getField('artStartDate.error').html(artDate(artDates,dob)).show();
                    if(artDate(artDates,dob)!=null)
                    {
                        submit = false;
                    }


        });
        
 
 if(submit == false)
 {
     //alert("Some entries have been incorectly filled\nPlease review the form and resubmit");
    
 }
 //alert(submit+"1ast");
 return submit;
});

   $j(':input').blur(function () {
    var submit = true;
 //alert(submit+"1st");
 //$("#try").append("dvsdfgsdf");
 
$j(function() {
 //setValue('weight.error',"*wrong input*");
 var value=getValue('height.value');
 if(value!="")
 {
     getField('height.error').html(height(value)).show();
     if(height(value)!=null)
     {
      submit = false;   
     }
            
 }
 });
 
 
 $j(function() {
 //setValue('weight.error',"*wrong input*");
 var value=getValue('weight.value');
 if(value!="")
 {
     getField('weight.error').html(weight(value)).show();
      if(weight(value)!=null)
     {
      submit = false;   
     }
 }
 
 });
 
$j(function() {
 //setValue('weight.error',"*wrong input*");
 var value=getValue('fpStatus.value');
 var age = getValue('age.value');
 if(age!=null)
 {  
     if(value!="")
     {
         getField('fpStatus.error').html(fp64(age,value)).show();
          if(fp64(age,value)!=null)
     {
      submit = false;   
     }
     }
     
 }
 
 //setValue('weight.value', "90");
 
 });
 
 

 $j(function() {
 //setValue('weight.error',"*wrong input*");
 var value = getValue('pg.value');
 var age = getValue('age.value');
 
 if(age!=null)
 {
     if(value!="")
     {   
         
         getField('pg.error').html(pg61(age,value)).show();
          if(pg61(age,value)!=null)
     {
      submit = false;   
     }
     }
 }
 });
 
 
 $j(function() {
   
 //setValue('weight.error',"*wrong input*");
 var value = getValue('cd4p.value');
 if(value!="")
 {
     getField('cd4p.error').html(CD4Percentage(value)).show();
      if(CD4Percentage(value)!=null)
     {
      submit = false;   
     }
 }
 
 });
 
 
 $j(function() {
 //setValue('weight.error',"*wrong input*");
 var value = getValue('cd4c.value');
 var age = getValue('age.value');
 
 if(value!="")
 {
     if(age!=null)
     {
         getField('cd4c.error').html(CD4(value,age)).show();
             if(CD4(value,age)!=null)
     {
      submit = false;   
     }
     }
     
 }
 
 });
 
 $j(function() {
 //setValue('weight.error',"*wrong input*");
 var currentVisit = getValue('currentVisit.value');
 var next = getValue('next.value');
 
 
 
 if(next!="")
 {
     if(currentVisit!="")
     { 
         
         getField('next.error').html(nxtvisit71(next,currentVisit)).show();
                  if(nxtvisit71(next,currentVisit)!=null)
     {
      submit = false;   
     }
     }
     
 }
 
 });
 
 $j(function() {
            //setValue('weight.error',"*wrong input*");
            var artDates = getValue('artStartDate.value');
            var dob = dateOfBirth;


                    getField('artStartDate.error').html(artDate(artDates,dob)).show();
                    if(artDate(artDates,dob)!=null)
                    {
                        submit = false;
                    }


        });
        
 if(submit == false)
 {
     //alert("Some entries have been incorectly filled\nPlease review the form and resubmit");
    
 }
 //alert(submit+"1ast");
 return submit;
});

    });



    //validation
    //date of HIV


    function convertDay(aDate)
    {
        return aDay = Number(aDate[8]+aDate[9])-2;
    }

    function convertMonth(aDate)
    {
        return aMonth = Number(aDate[5]+aDate[6])-1;
    }

    function convertYear(aDate)
    {
        return aYear = Number(aDate[0]+aDate[1]+aDate[2]+aDate[3]);
    }


    function height(value)
    {
        var content = value;
    
      
        if(30>content)
        {
            return "The Height in Cms is outside the Normal Range";
        }
        else if(content>180)
        {
            return "The Height in Cms is outside the Normal Range";
        }
          else{
            return null;
        }
    
    }
    function weight(value)
{
    var content = value;

    if(3>content)
    {
       
        return "The Weight in Kgs is outside the Normal Range";
    }
      else if(content>150)
        {
            return "The Weight in Kgs is outside the Normal Range";
        }
        else{
            return null;
        }
}
//how to to get age
function fp64(value,fpstatus)
 {
      var age = value;
     


         if(age&lt;15)
    {
        if(fpstatus==="true")
        {
                
                return "Is this Child on Family Planning?";
        }
        
    }
        else{
            return null;
        }
 }

function pg61(value,pgstatus)
 {
      var age = value;
      
     if(age&lt;15)
    {
        if(pgstatus==="1065")
        {
                
                return "Is this Child Pregnant?";
        }
        
    }
        else{
            return null;
        }
 }
 
 
 function CD4Percentage(CD4Perc)
{
    if(CD4Perc>100)
    {
        return"CD4 Percentage is above 100%";
    }

    else if(CD4Perc>24)
    {
        return"The CD4 Percentage is greater than the required % for Starting ARVs (24%)";
    }

    else if(0>CD4Perc)
    {
        return"CD4 Percentage is below Zero";
    }
        else{
            return null;
        }

}



function CD4(CD4value,age)
{

    //ask about the specifications step 27

    if(CD4value>7000)
    {
        if(13>age)
        {
            return "CD4 is above Normal for a Patient below 13 Years";
        }

    }

    else if(CD4value>1500)
    {
        if(age>12)
        {
            return "CD4 is above Normal for a Patient above 12 Years";
        }

    }

    else if(0>CD4value)
    {
        return "CD4 is below Zero";
    }
    else{
            return null;
        }
}


function nxtvisit71(visit,currvisit)
 {
     
    
    var day = convertDay(visit);
    var month = convertMonth(visit);
    var year = convertYear(visit);
    
    var day1 = convertDay(currvisit);
    var month1 = convertMonth(currvisit);
    var year1 = convertYear(currvisit);
    
    var visit = day+((month/12)*365)+(year*365);
    var currvisit=day1+((month1/12)*365)+(year1*365);
         if(visit &lt; currvisit)
    {
        return "The next Visit Date is before the current Visit Date";
    }
        else{
            return null;
        }
 }

function artDate(art,dob)
{
    //checking that date started ART is after dob
    var content = art;//art date
    var day = convertDay(content);
    var month = convertMonth(content);
    var year = convertYear(content);

    var artDate = day+((month/12)*365)+(year*365);//ART date


    day = convertDay(dob);
    month = convertMonth(dob);
    year = convertYear(dob);

    var DoB = day+((month/12)*365)+(year*365);//date of birth


    //checking that art date is not before discovery of hiv
    if(hivDiscovered>artDate)
    {
        return "Date Started ART is before the HIV case was Discovered";
    }


    else if(DoB>artDate)
    {
        return "Date Started ART is before the Date of Birth";
    }


    else
    {
        return null;
    }
}

 
</script>

<div class="main">
<ul class="tabs">
    <li><a href="#visit_form1">Visit Information Page 1</a></li>
    <li><a href="#visit_form2">Visit Information Page 2</a></li>
</ul>
<div class="tab_container">
<fieldset>
    <legend><strong>Encounter Details</strong></legend>
    <table width="100%" border="0" align="center">
        <tr>
            <td width="11%" class="textalign_right">Encounter Date:</td>
            <td width="17%"><encounterDate/></td>
            <td width="19%" class="textalign_right">Encounter Location:</td>
            <td width="17%"><encounterLocation/></td>
            <td width="18%" class="textalign_right">Encounter Provider:</td>
            <td width="18%"><encounterProvider/></td>
           
        </tr>
    </table>
</fieldset>
<!--TAB 1 HERE-->
<div id="visit_form1" class="tab_content">
    <span style="float:right">Paper Form ID: </span>
    <div id="form1">
        <section>
            <table width="90%" class="baseline-aligne">
                <tr>
                    <td  >Patient id:</td>
                    <td style="color:brown"> <lookup expression="patient.personId"/></td>
                    <td >Patient Name:</td>
                    <td style="color: brown"> <lookup expression="patient.personName"/></td>
                    <td>Patient age:</td>
                    <td style="color: brown"><lookup expression="patient.age"/></td>
                      <td>Patient Birth Date:</td>
                    <td style="color: brown"><lookup id="dob" expression="patient.birthdate"/></td>
                
            <td style="color: brown;display: none;"><patient  field="birthDate" /></td>
            <td style="color: brown"><input type="hidden" name="dob" id="dob" value=""  /></td>
                </tr>
            </table>
        </section>

        <section headerLabel="COMPREHENSIVE CARE CLINIC PATIENT CARD - MOH 257
                  INITIAL AND FOLLOW UP VISIT">
            <table width="85%" align="center" class="maincopy">
                <tr >
                    <td width="233" class="textalign_right">Visit Date:</td>
                    <td width="265"><encounterDate id="currentVisit" labelText="Visit Date:"/></td>
                    <td width="255" class="textalign_right">Visit type:</td>
                    <td width="309"><obs conceptId="160530AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" /></td>
                </tr>
                <tr>
                    <td>Duration Since (In Months)</td>
                </tr>
                <tr >
                    <td class="textalign_right">Start ART:</td>
                    <td><encounterDate id="artStartDate" labelText="Visit Date:"/></td>
                    <td class="textalign_right">Current Regimen:</td>
                    <td><obs conceptId="162240"/></td>
                </tr>
                <tr >
                    <td class="textalign_right">Weight (kgs)/BP:</td>
                    <td><obs id="weight" conceptId="5089" size="5"/></td>
                    <td class="textalign_right">Height (cm):</td>
                    <td><obs id="height" conceptId="5090" size="5"/></td>
                </tr>
                <tr >
                    <td class="textalign_right">BMI:</td>
                    <td><obs id="bmi" conceptId="1342" size="5"/></td>
                </tr>
                <tr>
                    <td>Pregnancy</td>
                </tr>
                <tr >
                    <td class="textalign_right">Status:</td>
                    <td><obs id="pg" conceptId="5272" style="no_yes_dropdown" /></td>
                    <td class="textalign_right">EDD:</td>
                    <td><obs conceptId="5596" size="5"/></td>
                </tr>
                <tr>
                    <td>Family Planning</td>
                </tr>
                <tr >
                    <td class="textalign_right">FP Status:</td>
                    <td><obs conceptId="160653" style="no_yes_dropdown" /></td>
                    <td class="textalign_right">FP/No FP:</td>
                    <td><obs id="fpStatus" conceptId="965" style="no_yes_dropdown"/></td>
                </tr>
                <tr>
                    <td class="textalign_right">FP method:</td>
                    <td><obs conceptId="374AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  style="checkbox" size="5"/></td>
                </tr>
                <tr>
                    <td>Tuberculosis status</td>
                </tr>
                <tr >
                    <td class="textalign_right"> Status:</td>
                    <td><obs conceptId="1659" style="no_yes_dropdown" /></td>
                    <td class="textalign_right">TB RX:</td>
                    <td><obs conceptId="830" size="5"/></td>
                </tr>
                <tr>
                    <td class="textalign_right">Potential Side Effects:</td>
                    <td><obs conceptId="159935AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="checkbox" size="5"/></td>
                </tr>
                <tr>
                    <td class="textalign_right">New OI and Othet Problems:</td>
                    <td></td>
                </tr>
                <tr>
                    <td class="textalign_right">WHO Stage:</td>
                    <td><obs id="who" conceptId="5356" /></td>
                </tr>
                <tr>
                    <td>Cotrimozale</td>
                </tr>
                <tr >
                    <td class="textalign_right">Cotrimozale:</td>
                    <td><obs conceptId="161652"  /></td>
                    <td class="textalign_right">Adherence:</td>
                    <td><obs conceptId="161652" /></td>
                </tr>
                <tr >
                    <td class="textalign_right">CTX Dispensed:</td>
                    <td><obs conceptId="162229"  /></td>
                    <td class="textalign_right">INH Dispensed:</td>
                    <td><obs conceptId="162230" /></td>
                </tr>
            </table>
        </section>
    </div>

    <ul class="tabs_visit_form2">
        <li><a href="#visit_form2"><center><button type="button" class="text ui-widget-content ui-corner-all" id="add_patientProfile" name="update" value="update"><img class="button_img" src="../../images/icons/tick.png" alt="" width="14" height="16"/> NEXT  </button></center></a></li></ul>
</div>
<!--TAB 2 HERE-->
<div id="visit_form2" class="tab_content">
    <section headerLabel="COMPREHENSIVE CARE CLINIC PATIENT CARD - MOH 257
                  INITIAL AND FOLLOW UP VISIT">

        <table width="98%" align="center" class="maincopy">
            <tr >

                <td width="25%" class="textalign_right">Other Medical Dispensed?:</td>
                <td width="22%"><obs conceptId="1282"  /></td>
                <td width="25%" class="textalign_right">If yes Specify::</td>
                <td width="28%"><obs conceptId="162230" /></td>

            </tr>
            <tr>
                <td>ARV Drugs:</td>
            </tr>
            <tr>
                <td>ARV Drugs Adherence?:</td>
                <td><obs conceptId="1658" /></td>
            </tr>
            <tr>
                <td>If ARV Drugs Adherence is Unsatisfactory, Why?:</td>
            </tr>
            <tr>
                <td>Unsatisfactory Reason:</td>
                <td><div class="divmain"><div class="childmain"><obs conceptId="160582AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" size="5" /></div></div></td>
            </tr>

            <tr >

                <td class="textalign_right">ARV Regimen:</td>
                <td><obs conceptId="1251"  /></td>
                <td class="textalign_right"> Dose:</td>
                <td><obs conceptId="1251" /></td>

            </tr>
            <tr>
                <td>Laboratory Investigations:</td>
            </tr>
            <tr >

               <!-- <td class="textalign_right">CD4 Done (# or %):</td>
                <td><obs id=conceptId="5497"  /></td>-->
                <td class="textalign_right">CD4 Date:</td>
                <td><encounterDate labelText="Visit Date:"/></td>

            </tr>

            <tr >

                <td class="textalign_right">CD4 Count:</td>
                <td><obs id="cd4c" conceptId="5497"  /></td>
                <td class="textalign_right">CD4 %:</td>
                <td><obs id="cd4p" conceptId="730"  /></td>

            </tr>
            <tr >

                <td class="textalign_right">HGB:</td>
                <td><obs id="hgb1" conceptId="21"  /></td>
                <td class="textalign_right">HGB Result:</td>
                <td><obs id="hgb2" conceptId="21"  /></td>

            </tr>
            <tr >

                <td class="textalign_right">RPR:</td>
                <td><obs conceptId="1619"  /></td>
                <td class="textalign_right">RPR Result:</td>
                <td><obs  conceptId="1619"  /></td>

            </tr>
            <tr >

                <td class="textalign_right">TB Spatum:</td>
                <td><obs conceptId="307"  /></td>
                <td class="textalign_right">TB Spatum results:</td>
                <td><obs  conceptId="307"  /></td>

            </tr>
            <tr> Other Lab Test:</tr>
            <tr >

                <td class="textalign_right">Refered to:</td>
                <td><obs conceptId="1272"  /></td>
                <td class="textalign_right">If hospitalized, No. of Days:</td>
                <td><obs  conceptId="1272"  /></td>

            </tr>
            <tr>
                <td>At Risk Population:</td>
                <td><obs conceptId="1272"  /></td>
            </tr>
            <tr >

                <td class="textalign_right">Date of Next Appointment :</td>
                <td><obs id="next" conceptId="5096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  /></td>
                <td class="textalign_right">Clinician Initial:</td>
                <td><obs  conceptId="1473"  /></td>

            </tr>

        </table>
        <center><submit submitLabel="Complete And Close"/></center>
    </section>
</div>

</div>

</div>
</htmlform>
